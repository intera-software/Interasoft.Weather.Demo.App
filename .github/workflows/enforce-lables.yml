name: Enforce PR Labels

on:
  workflow_dispatch:
  pull_request:
    types: [labeled, unlabeled, opened, synchronize, reopened]
  
permissions: {}

jobs:
  enforce-label:
    name: Check blocking lables
    runs-on: ubuntu-latest
    steps:
      - name: Block if labels present
        if: |
          contains(github.event.pull_request.labels.*.name, 'hold') ||
          contains(github.event.pull_request.labels.*.name, 'needs-qa') ||
          contains(github.event.pull_request.labels.*.name, 'security-hold')
        run: |
          echo "::error::ðŸš« This PR has blocking labels that prevent merging"

          # Create a pretty formatted message with colors and emojis
          cat >> $GITHUB_STEP_SUMMARY << EOF
          ## ðŸ›‘ **Merge Blocked** 

          > **âš ï¸ Critical Issue:** This pull request contains blocking labels that prevent it from being merged.

          ### ðŸ“‹ **Action Required**
          Remove the following labels to proceed with merging:

          | Label | Status | Action |
          |-------|--------|--------|
          | ðŸ”’ **hold** | âŒ Blocking | Remove to unblock |
          | ðŸ§ª **needs-qa** | âŒ Blocking | Complete QA process |
          | ðŸ” **security-hold** | âŒ Blocking | Resolve security concerns |

          ---

          ### ðŸš€ **Next Steps**
          1. **Review** the blocking labels above
          2. **Complete** any required actions (QA, security review, etc.)
          3. **Remove** the blocking labels
          4. **Re-run** the workflow to proceed with merge

          > ðŸ’¡ **Tip:** Once all blocking labels are removed, the merge process will automatically continue!

          EOF

          exit 1
      - name: No blocking labels
        if: |
          !contains(github.event.pull_request.labels.*.name, 'hold') &&
          !contains(github.event.pull_request.labels.*.name, 'needs-qa') &&
          !contains(github.event.pull_request.labels.*.name, 'security-hold')
        run: |
          echo "âœ… No blocking labels found - PR can be merged"

          # Create a pretty formatted success message with colors and emojis
          cat >> $GITHUB_STEP_SUMMARY << EOF
          ## ðŸŽ‰ **Ready to Merge!** 

          > **âœ¨ Great news!** This pull request has passed all label checks and is clear for merging.

          ### ðŸ” **Label Check Results**
          | Check | Status | Result |
          |-------|--------|--------|
          | ðŸ”’ **hold** | âœ… Clear | No blocking hold labels |
          | ðŸ§ª **needs-qa** | âœ… Clear | QA requirements met |
          | ðŸ” **security-hold** | âœ… Clear | No security concerns |

          ---

          ### ðŸš€ **All Systems Go!**
          - âœ… **Label validation:** Passed
          - âœ… **Merge readiness:** Confirmed  
          - âœ… **Workflow status:** Green light

          > ðŸŽ¯ **Ready for action:** This PR is now eligible for merging and can proceed through your standard merge process!

          ---
          <div align="center">

          **ðŸŒŸ Happy merging! ðŸŒŸ**

          </div>

          EOF
        