name: Release

on:
  push:
    branches:
      - main
  repository_dispatch:
    types: [semantic-release]

permissions:
  contents: read

jobs:
  release:
   name: Release
   runs-on: ubuntu-latest
   permissions:
    contents: write
    issues: write
    pull-requests: write
    id-token: write
   steps:
    - name: Checkout repo
      uses: actions/checkout@v5
      with:
        fetch-depth: 0
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: "lts/*"
    - name: Install dependencies
      run: npm clean-install
    - name: Verify the integrity of dependencies
      run: npm audit signatures
    - name: Release
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
      run: npx semantic-release
