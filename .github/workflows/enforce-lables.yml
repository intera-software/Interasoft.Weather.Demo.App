name: Enforce PR Labels

on:
  workflow_dispatch:
  pull_request:
    types: [labeled, unlabeled, opened, synchronize, reopened]
  
permissions: {}

jobs:
  enforce-label:
    name: Check blocking lables
    runs-on: ubuntu-latest
    steps:
      - name: Block if labels present
        if: |
          contains(github.event.pull_request.labels.*.name, 'hold') ||
          contains(github.event.pull_request.labels.*.name, 'needs-qa') ||
          contains(github.event.pull_request.labels.*.name, 'security-hold')
        run: |
          echo "::error::This PR has blocking labels that prevent merging"
          echo "### :x: Blocking labels found" >> $GITHUB_STEP_SUMMARY
          echo "Remove the following labels to allow merging:" >> $GITHUB_STEP_SUMMARY
          echo "- hold, needs-qa or security-hold" >> $GITHUB_STEP_SUMMARY
          exit 1
      - name: No blocking labels
        if: |
          !contains(github.event.pull_request.labels.*.name, 'hold') &&
          !contains(github.event.pull_request.labels.*.name, 'needs-qa') &&
          !contains(github.event.pull_request.labels.*.name, 'security-hold')
        run: |
          echo "### :white_check_mark: No blocking labels found" >> $GITHUB_STEP_SUMMARY
          echo "This PR can be merged" >> $GITHUB_STEP_SUMMARY